@model MoralCompass.Web.Controllers.DiscussionItemController.DiscussionItemDetailModel
@{
    ViewData["Title"] = Model.Item?.Title ?? "–î–∏–ª–µ–º–º–∞";
}

<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>@ViewData["Title"]</title>
    <link href="~/css/discussion.css" rel="stylesheet" />
    <link rel="icon" type="image/png" sizes="16x16" href="~/images/icon.png" />
</head>
<body>

    <!-- üîπ –ù–∞–≤–∏–≥–∞—Ü–∏—è -->
    <nav class="nav">
        <a href="@Url.Action("Index", "Confession")" class="nav-link">–ù–µ –º—É–¥–∞–∫ –ª–∏ —è?</a>
        <a href="#" class="nav-link">–ü–æ–∏—Å–∫</a>
        <a href="@Url.Action("Stats", "Index")" class="nav-link">–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞</a>
    </nav>

    <!-- üî∏ –ó–∞–≥–æ–ª–æ–≤–æ–∫ –∑–∞–ø–æ–≤–µ–¥–∏ -->
    @if (Model.Topic?.CoreThesis != null)
    {
        <header class="thesis-header">
            <h1 class="thesis-title">@Model.Topic.CoreThesis.Title</h1>
            <p class="thesis-description">@Model.Topic.CoreThesis.Description</p>
        </header>
    }

    <!-- üîπ –î–∏–ª–µ–º–º–∞ -->
    <main class="discussion-main">
        <p class="login-info">
            @Model.Author.Nickname ¬∑ @Model.Item?.CreatedAt.ToString("dd.MM.yyyy HH:mm")
        </p>
        <p class="discussion-content">@Model.Item?.Content</p>

        <h2 class="comments-title">–ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏ (@Model.Comments.Count)</h2>

        <!-- üî∏ –°–∫—Ä–æ–ª–ª-–∫–æ–Ω—Ç–µ–π–Ω–µ—Ä -->
        <div class="comments-scroll">
            <!-- üîπ –§–æ—Ä–º–∞ –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏—è -->
            @if (User.Identity?.IsAuthenticated == true)
            {
                <form method="post" asp-action="AddComment" asp-route-id="@Model.Item?.Id" class="comment-form">
                    <input type="text" name="content" class="comment-input" placeholder="–û—Å—Ç–∞–≤–∏—Ç—å –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π" required />
                </form>
            }
            else
            {
                <p class="guest-message">
                    –ß—Ç–æ–±—ã —É—á–∞—Å—Ç–≤–æ–≤–∞—Ç—å –≤ –æ–±—Å—É–∂–¥–µ–Ω–∏–∏, 
                    <a href="@Url.Action("Login", "Auth")" class="auth-link">–≤–æ–π–¥–∏—Ç–µ</a>.
                </p>
            }

            <!-- üîπ –ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏ -->
            @if (!Model.Comments.Any())
            {
                <p class="empty-comments">–ü–æ–∫–∞ –Ω–∏–∫—Ç–æ –Ω–µ –ø—Ä–æ–∫–æ–º–º–µ–Ω—Ç–∏—Ä–æ–≤–∞–ª. –°—Ç–∞–Ω—å—Ç–µ –ø–µ—Ä–≤—ã–º.</p>
            }
            else
            {
                @foreach (var c in Model.Comments)
                {
                    <div class="comment-item">
                        <p class="login-info">@c.AuthorNickname ¬∑ @c.Comment.CreatedAt.ToString("dd.MM HH:mm")</p>
                        <p class="comment-text">@c.Comment.Content</p>

                        <!-- üîπ –†–µ–∞–∫—Ü–∏–∏ -->
                        <div class="reactions">
                            <form method="post" asp-action="ToggleCommentReaction" asp-route-commentId="@c.Comment.Id" asp-route-value="1">
                                <button type="submit" class="reaction-btn @(c.UserReaction == 1 ? "liked" : "")">
                                    üëç @c.Likes
                                </button>
                            </form>
                            <form method="post" asp-action="ToggleCommentReaction" asp-route-commentId="@c.Comment.Id" asp-route-value="-1">
                                <button type="submit" class="reaction-btn @(c.UserReaction == -1 ? "disliked" : "")">
                                    üëé @c.Dislikes
                                </button>
                            </form>
                            @if (c.UserReaction != 0)
                            {
                                <form method="post" asp-action="ToggleCommentReaction" asp-route-commentId="@c.Comment.Id" asp-route-value="0">
                                    <button type="submit" class="reaction-btn cancel">‚úï</button>
                                </form>
                            }
                        </div>
                    </div>
                }
            }
        </div>
    </main>

</body>
</html>
