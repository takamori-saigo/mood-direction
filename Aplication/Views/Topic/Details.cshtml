@model MoralCompass.Web.Controllers.TopicController.TopicDetailModel
@{
    ViewData["Title"] = Model.Topic?.Title ?? "–¢–µ–º–∞";
}

<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>@ViewData["Title"]</title>

    <!-- Bootstrap 5 CSS (–Ω—É–∂–µ–Ω –¥–ª—è –º–æ–¥–∞–ª—å–Ω–æ–≥–æ –æ–∫–Ω–∞) -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" />

    <!-- –í–∞—à –∫–∞—Å—Ç–æ–º–Ω—ã–π CSS -->
    <link href="~/css/theme.css" rel="stylesheet" />
    <link rel="icon" type="image/png" sizes="16x16" href="~/images/icon.png" />
</head>
<body>

    <!-- üîπ –ù–∞–≤–∏–≥–∞—Ü–∏—è –≤ —Å—Ç–∏–ª–µ "–ù–µ –º—É–¥–∞–∫ –ª–∏ —è?" -->
    <div class="nav">
        <a href="@Url.Action("Index", "Confession")" class="nav-link">–ù–µ –º—É–¥–∞–∫ –ª–∏ —è?</a>
        <a href="#" class="nav-link">–ü–æ–∏—Å–∫</a>
        <a href="@Url.Action("Stats", "Index")" class="nav-link">–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞</a>
    </div>

    <!-- üî∏ –û–ø–∏—Å–∞–Ω–∏–µ —Ä–æ–¥–∏—Ç–µ–ª—å—Å–∫–æ–π –∑–∞–ø–æ–≤–µ–¥–∏ -->
    <div style="text-align: center; margin: 30px 0;">
        <h2 style="font-size: 36px; margin-bottom: 5px;">@Model.CoreThesis.Title</h2>
        <p class="description-p">
            @Model.CoreThesis.Description
        </p>
    </div>

    <!-- üîπ –ö–Ω–æ–ø–∫–∞ "–î–æ–±–∞–≤–∏—Ç—å –¥–∏–ª–µ–º–º—É" (—Å–Ω–∞—Ä—É–∂–∏ –º–æ–¥–∞–ª–∫–∏!) -->
    @if (User.Identity?.IsAuthenticated == true)
    {
        <div style="text-align: center; margin-bottom: 20px;">
            <button type="button" class="btn btn-sm btn-outline-primary" data-bs-toggle="modal" data-bs-target="#addDilemmaModal">
                –î–æ–±–∞–≤–∏—Ç—å –¥–∏–ª–µ–º–º—É
            </button>
        </div>

        <!-- üî∏ –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ (–æ—Å—Ç–∞—ë—Ç—Å—è –∫–∞–∫ –≤ —Å—Ç–∞—Ä–æ–º) -->
        <div class="modal fade" id="addDilemmaModal" tabindex="-1">
            <div class="modal-dialog">
                <div class="modal-content">
                    <div class="modal-header">
                        <h5 class="modal-title">–ù–æ–≤–∞—è –¥–∏–ª–µ–º–º–∞</h5>
                        <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                    </div>
                    <form method="post" asp-action="AddDilemma" asp-controller="Topic">
                        <input type="hidden" name="id" value="@Model.Topic.Id" />
                        <div class="modal-body">
                            <div class="mb-3">
                                <label class="form-label">–ó–∞–≥–æ–ª–æ–≤–æ–∫</label>
                                <input name="title" class="form-control" placeholder="–ù–∞–ø—Ä–∏–º–µ—Ä: ¬´–ú–æ–∂–Ω–æ –ª–∏ –≤—Ä–∞—Ç—å –≤–æ –±–ª–∞–≥–æ?¬ª" required />
                            </div>
                            <div class="mb-3">
                                <label class="form-label">–û–ø–∏—Å–∞–Ω–∏–µ / –∫–µ–π—Å</label>
                                <textarea name="content" class="form-control" rows="4" 
                                    placeholder="–û–ø–∏—à–∏—Ç–µ —Å–∏—Ç—É–∞—Ü–∏—é, –∞—Ä–≥—É–º–µ–Ω—Ç—ã '–∑–∞' –∏ '–ø—Ä–æ—Ç–∏–≤'..." required></textarea>
                            </div>
                        </div>
                        <div class="modal-footer">
                            <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">–û—Ç–º–µ–Ω–∞</button>
                            <button type="submit" class="btn btn-primary">–û–ø—É–±–ª–∏–∫–æ–≤–∞—Ç—å</button>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    }

    <!-- üîπ –ü—Ä–æ–∫—Ä—É—á–∏–≤–∞–µ–º—ã–π —Å–ø–∏—Å–æ–∫ –¥–∏–ª–µ–º–º –≤ –Ω–æ–≤–æ–º —Å—Ç–∏–ª–µ -->
    <div class="scroll">
        @if (!Model.Dilemmas.Any())
        {
            <div style="text-align: center; padding: 50px 20px; font-size: 20px; color: #777;">
                –í —ç—Ç–æ–π —Ç–µ–º–µ –ø–æ–∫–∞ –Ω–µ—Ç –¥–∏–ª–µ–º–º.
            </div>
        }
        else
        {
            @foreach (var dilemma in Model.Dilemmas)
            {
                <div class="card">
                    <!-- –õ–æ–≥–∏–Ω + –¥–∞—Ç–∞ -->
                    <p class="login-info">
                        @dilemma.Author.Nickname ¬∑ @dilemma.Item.CreatedAt.ToString("dd.MM.yyyy")
                    </p>

                    <!-- –¢–µ–∫—Å—Ç –¥–∏–ª–µ–º–º—ã -->
                    <p class="comment-info">@dilemma.Item.Content</p>

                    <!-- –ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏ -->
                    <div class="top-comment">
                        <p class="comment-p">–ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏ (@dilemma.TotalCommentCount)</p>
                        @if (dilemma.TopComments.Any())
                        {
                            @foreach (var c in dilemma.TopComments.Take(2))
                            {
                                <div class="comment-card">
                                    <p class="comment-card-p">@c.Comment.Content</p>
                                </div>
                            }
                        }
                        else
                        {
                            <div class="comment-card">
                                <p class="comment-card-p">–ü–æ–∫–∞ –Ω–µ—Ç –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–µ–≤.</p>
                            </div>
                        }
                    </div>

                    <!-- üîπ –ö–Ω–æ–ø–∫–∞ "–û–±—Å—É–¥–∏—Ç—å" ‚Äî –ø—Ä–∏–∂–º—ë—Ç—Å—è –∫ –Ω–∏–∑—É –±–ª–∞–≥–æ–¥–∞—Ä—è margin-top: auto -->
                    <div class="card-actions">
                        <a href="@Url.Action("Details", "DiscussionItem", new { id = dilemma.Item.Id })"
                           class="btn btn-sm btn-outline-primary">
                            –û–±—Å—É–¥–∏—Ç—å ‚Üí
                        </a>
                    </div>
                </div>
            }
        }
    </div>

    <!-- Bootstrap JS (–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ –¥–ª—è –º–æ–¥–∞–ª–∫–∏) -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>

</body>
</html>
