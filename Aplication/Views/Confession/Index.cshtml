@{
    var confessions = ViewBag.Confessions as List<MoralCompass.Infrastructure.Domain.DiscussionItem>;
    var commentCounts = ViewBag.CommentCounts as Dictionary<Guid, int> ?? new();
    ViewData["Title"] = "–ù–µ –º—É–¥–∞–∫ –ª–∏ —è?";
}

<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>@ViewData["Title"]</title>
    <link href="~/css/confession.css" rel="stylesheet" />
</head>
<body>

    <!-- üîπ –ù–∞–≤–∏–≥–∞—Ü–∏—è (–∫–∞–∫ –≤ Topic/Thesis) -->
    <nav class="nav">
        <a href="@Url.Action("Index", "Confession")" class="nav-link active">–ù–µ –º—É–¥–∞–∫ –ª–∏ —è?</a>
        <a href="#" class="nav-link">–ü–æ–∏—Å–∫</a>
        <a href="@Url.Action("Stats", "Index")" class="nav-link">–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞</a>
    </nav>

    <!-- üî∏ –ó–∞–≥–æ–ª–æ–≤–æ–∫ –∏ –∫–Ω–æ–ø–∫–∞ -->
    <div class="header-section">
        <h1 class="section-title">–ù–µ –º—É–¥–∞–∫ –ª–∏ —è?</h1>
        <p class="section-subtitle">–õ–∏—á–Ω—ã–µ –¥–∏–ª–µ–º–º—ã. –ß–µ—Å—Ç–Ω—ã–µ –≤–æ–ø—Ä–æ—Å—ã. –ü–æ–¥–¥–µ—Ä–∂–∫–∞ –±–µ–∑ –æ—Å—É–∂–¥–µ–Ω–∏—è.</p>
    
        <div class="header-buttons">
            @if (User.Identity?.IsAuthenticated == true)
            {
                <a href="@Url.Action("Create", "Confession")" class="btn btn-primary">–ó–∞–¥–∞—Ç—å —Å–≤–æ–π –≤–æ–ø—Ä–æ—Å</a>
            }
            else
            {
                <a href="@Url.Action("Login", "Auth")" class="btn btn-outline-primary">–í–æ–π–¥–∏—Ç–µ, —á—Ç–æ–±—ã –∑–∞–¥–∞—Ç—å –≤–æ–ø—Ä–æ—Å</a>
            }
    
            <a href="@Url.Action("Index", "Index")" class="btn btn-secondary">–ù–∞–∑–∞–¥ –Ω–∞ –≥–ª–∞–≤–Ω—É—é</a>
        </div>
    </div>

    <!-- üîπ –°–ø–∏—Å–æ–∫ –¥–∏–ª–µ–º–º -->
    <div class="confessions-container">
        @if (confessions == null || !confessions.Any())
        {
            <div class="empty-state">
                <p>–ü–æ–∫–∞ –Ω–∏–∫—Ç–æ –Ω–µ –ø–æ–¥–µ–ª–∏–ª—Å—è —Å–≤–æ–µ–π –¥–∏–ª–µ–º–º–æ–π.</p>
                @if (User.Identity?.IsAuthenticated == true)
                {
                    <a href="@Url.Action("Create", "Confession")" class="btn btn-sm btn-outline-primary">
                        –°—Ç–∞—Ç—å –ø–µ—Ä–≤—ã–º ‚Üí
                    </a>
                }
            </div>
        }
        else
        {
            @foreach (var di in confessions)
            {
                <div class="confession-item">
                    <div class="confession-title">
                        <span class="confession-text">@di.Title</span>
                        <span class="badge">–õ–∏—á–Ω–æ–µ</span>
                    </div>
                    <p class="confession-meta">
                        @(di.Author?.Nickname ?? "–ê–Ω–æ–Ω–∏–º") ¬∑ @di.CreatedAt.ToString("dd.MM.yyyy HH:mm")
                    </p>
                    <p class="confession-content">@di.Content</p>
                    <div class="confession-footer">
                        <span class="comment-count">@commentCounts.GetValueOrDefault(di.Id, 0) –∫–æ–º–º–µ–Ω—Ç.</span>
                        <a href="@Url.Action("Details", "DiscussionItem", new { id = di.Id })" class="btn btn-outline-primary">
                            –û–±—Å—É–¥–∏—Ç—å ‚Üí
                        </a>
                    </div>
                </div>
            }
        }
    </div>

</body>
</html>
