@model MoralCompass.Web.Controllers.TopicController.TopicDetailModel
@{
    ViewData["Title"] = Model.Topic?.Title ?? "–¢–µ–º–∞";
}

<div class="container mt-3">
    <!-- üîπ –•–ª–µ–±–Ω—ã–µ –∫—Ä–æ—à–∫–∏ -->
    <nav aria-label="breadcrumb" class="mb-3">
        <ol class="breadcrumb small">
            <li class="breadcrumb-item">
                <a href="@Url.Action("Index", "Index")">–ì–ª–∞–≤–Ω–∞—è</a>
            </li>
            <li class="breadcrumb-item">
                <a href="@Url.Action("Details", "Thesis", new { id = Model.CoreThesis.Id })">
                    @Model.CoreThesis.Title
                </a>
            </li>
            <li class="breadcrumb-item active" aria-current="page">
                @Model.Topic.Title
            </li>
        </ol>
    </nav>

    <!-- üîπ –ó–∞–≥–æ–ª–æ–≤–æ–∫ —Ç–µ–º—ã + –∫–Ω–æ–ø–∫–∞ -->
    <div class="d-flex justify-content-between align-items-baseline mb-4">
        <div>
            <h3>@Model.Topic.Title</h3>
            <p class="text-muted">
                @Model.Topic.Author.Nickname ¬∑ 
                @Model.Topic.CreatedAt.ToString("dd.MM.yyyy")
            </p>
        </div>
        <!-- üîπ –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ: –¥–æ–±–∞–≤–∏—Ç—å –¥–∏–ª–µ–º–º—É -->
        @if (User.Identity?.IsAuthenticated == true)
        {
            <div class="modal fade" id="addDilemmaModal" tabindex="-1">
                <div class="modal-dialog">
                    <div class="modal-content">
                        <div class="modal-header">
                            <h5 class="modal-title">–ù–æ–≤–∞—è –¥–∏–ª–µ–º–º–∞</h5>
                            <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                        </div>
                        <form method="post" asp-action="AddDilemma" asp-controller="Topic">
                            <input type="hidden" name="id" value="@Model.Topic.Id" />
                            <div class="modal-body">
                                <div class="mb-3">
                                    <label class="form-label">–ó–∞–≥–æ–ª–æ–≤–æ–∫</label>
                                    <input name="title" class="form-control" placeholder="–ù–∞–ø—Ä–∏–º–µ—Ä: ¬´–ú–æ–∂–Ω–æ –ª–∏ –≤—Ä–∞—Ç—å –≤–æ –±–ª–∞–≥–æ?¬ª" required />
                                </div>
                                <div class="mb-3">
                                    <label class="form-label">–û–ø–∏—Å–∞–Ω–∏–µ / –∫–µ–π—Å</label>
                                    <textarea name="content" class="form-control" rows="4" 
                                      placeholder="–û–ø–∏—à–∏—Ç–µ —Å–∏—Ç—É–∞—Ü–∏—é, –∞—Ä–≥—É–º–µ–Ω—Ç—ã '–∑–∞' –∏ '–ø—Ä–æ—Ç–∏–≤'..." required></textarea>
                                </div>
                            </div>
                            <div class="modal-footer">
                                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">–û—Ç–º–µ–Ω–∞</button>
                                <button type="submit" class="btn btn-primary">–û–ø—É–±–ª–∏–∫–æ–≤–∞—Ç—å</button>
                            </div>
                        </form>
                    </div>
                </div>
            </div>
        }
    </div>

    <hr />

    <!-- üîπ –°–ø–∏—Å–æ–∫ –¥–∏–ª–µ–º–º -->
    @if (!Model.Dilemmas.Any())
    {
        <div class="text-center text-muted py-5">
            <p>–í —ç—Ç–æ–π —Ç–µ–º–µ –ø–æ–∫–∞ –Ω–µ—Ç –¥–∏–ª–µ–º–º.</p>
            @* –ö–Ω–æ–ø–∫–∞ —É–∂–µ –µ—Å—Ç—å —Å–≤–µ—Ä—Ö—É ‚Üí –Ω–µ –¥—É–±–ª–∏—Ä—É–µ–º *@
        </div>
    }

    @foreach (var dilemma in Model.Dilemmas)
    {
        <div class="card mb-4">
            <div class="card-body">
                <div class="d-flex justify-content-between">
                    <h5 class="card-title mb-1">@dilemma.Item.Title</h5>
                    <span class="badge bg-secondary">@dilemma.Item.Type</span>
                </div>

                <p class="text-muted small mb-2">
                    @dilemma.Author.Nickname ¬∑ 
                    @dilemma.Item.CreatedAt.ToString("dd.MM.yyyy HH:mm")
                </p>

                <div class="mb-3">@dilemma.Item.Content</div>

                <!-- üîπ –¢–æ–ø-5 –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–µ–≤ -->
                @if (dilemma.TopComments.Any())
                {
                    <div class="small mb-2">
                        <div class="text-muted">–¢–û–ü –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–µ–≤:</div>
                        @foreach (var c in dilemma.TopComments)
                        {
                            <div class="mt-2 p-2 border rounded">
                                <div class="d-flex justify-content-between">
                                    <strong>@c.AuthorNickname</strong>
                                    <span class="badge bg-secondary">@c.Score</span>
                                </div>
                                <div>@c.Comment.Content</div>
                            </div>
                        }
                    </div>
                }

                <!-- üîπ –ö–Ω–æ–ø–∫–∏ -->
                <div class="d-flex justify-content-between align-items-center">
                    <span class="text-muted small">
                        @dilemma.TotalCommentCount –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–µ–≤
                    </span>
                    <a href="@Url.Action("Details", "DiscussionItem", new { id = dilemma.Item.Id })"
                       class="btn btn-sm btn-outline-primary">
                        –û–±—Å—É–¥–∏—Ç—å
                    </a>
                </div>
            </div>
        </div>
    }
</div>



<style>
    body { background-color: #fafafa; color: #222; }
    .card { border: 1px solid #e0e0e0; }
    .badge { font-weight: normal; }
    .btn-outline-primary { border-color: #555; color: #555; }
    .btn-outline-primary:hover { background-color: #f0f0f0; }
    .text-muted { color: #777 !important; }
</style>

